<html ng-app="ngvis">
<head>
<title>ngVis Simple - A collection of charting components for angular.js</title>
<link href="style.css" rel="stylesheet">
</head>
<body ng-controller="ctrl">
<div class="p">
    <h2 class="serif">Asset Allocation</h2>
</div>
<metro-pie data="pieChartData" selected="selected" colors="colors"></metro-pie>

<div class="p">
<h2 class="serif">Valuation</h2>
</div>

    <hr>
<table class="full-width">
    <thead>
        <th>Name</th>
        <th class="text-right">Market Value</th>
        <th class="text-right">Price</th>
        <th class="text-right">P&L</th>
        <th class="text-right">Yield</th>
        <th class="text-right">Weight</th>
    </thead>
    <tbody>
    <tr 
        class="transition"
        ng-style="pieChartData[selected].label === a.AssetClassExposure ? highlight : undefined ;"
        ng-repeat="a in valuation.Holdings">
        <td>{{a.Asset.Name}}</td>
        <td class="text-right">{{a.Valuation.Amount.Amount.toFixed(2)}}</td>
        <td class="text-right">{{a.Valuation.Price.Amount.toFixed(2)}} {{a.Valuation.Price.CurrencySymbol}}</td>
        <td class="text-right">{{a.Valuation.ProfitLoss.Amount.toFixed(2)}}</td>
        <td class="text-right">{{a.Asset.Yield.toFixed(2)}}</td>
        <td class="text-right">{{a.Weight.toFixed(2)}} %</td>
    </tr>
    </tbody>
</table>



<script type="text/ng-template" id="charts/metro-pie.html">
    <div class="full-width cf bg-grey metro-pie">
        <div class="p--l transition" ng-class="{'half': selected === undefined, 'third': selected !== undefined}">
            <pie template-url="metro-pie-vis.html" resize="false"  data="data" colors="colors"></pie>
        </div>
        <div class="transition" ng-class="{'half': selected === undefined, 'third': selected !== undefined}">
            <legend template-url="metro-pie-legend.html" colors="colors" data="data"><legend>
        </div>
        <div class="metro-detail transition" ng-class="{'collapsed-column': pieDetail === undefined, 'third': pieDetail !== undefined}">
            <div class="p relative" style="background: {{pieDetail.color}};">

                <button class="metro-detail-close" ng-click="selectPie(selected)">
                <svg width="20px" viewBox="0 0 100 100">
                    <line x1="0" y1="0" x2="100" y2="100"/>
                    <line x1="0" y1="100" x2="100" y2="0"/>
                </svg>
                </button>

                <h3 class="metro-detail-title serif">{{pieDetail.percentage}}% {{pieDetail.label}}</h3>
                <div class="cf">
                    <div class="p-t metro-detail-subgroup" ng-repeat="val in pieDetail.subGroups">
                        <h3 class="serif metro-detail-percentage" style="font-size: {{val.fontSize}}px;">{{val.percentage.toFixed(2)}}%</h3>
                        <span class="uppercase">{{val.label}}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>


<script type="text/ng-template" id="metro-pie-vis.html">
<svg viewBox="0 0 {{width}} {{height}}" width="100%" preserveAspectRatio="true">
    <path 
        ng-mouseover="$parent.$parent.visuallyActivePie = $index" 
        ng-mouseleave="$parent.$parent.visuallyActivePie = undefined" 
        style="transform-origin: {{center[0]}} {{center[1]}};"
        class="transition"
        ng-class="{'metro-pie-unactive': $parent.$parent.visuallyActivePie !== undefined && $parent.$parent.visuallyActivePie !== $index}"
        ng-click="$parent.$parent.selectPie($index)" 
        ng-repeat="p in pieChartData" 
        ng-attr-d="M{{center[0]}},{{center[1]}} {{p.x1}},{{p.y1}} A{{radius}}, {{radius}} 0 {{p.largeArc}},1 {{p.x2}} {{p.y2}} z"
        fill="{{p.color}}"/>
</svg>
</script>

<script type="text/ng-template" id="metro-pie-legend.html">
<div>
    <div 
        ng-mouseover="$parent.$parent.visuallyActivePie = $index" 
        ng-mouseleave="$parent.$parent.visuallyActivePie = undefined" 
        ng-repeat="l in legend" 
        ng-click="$parent.$parent.selectPie($index)"  
        class="metro-legend" 
        style="background: {{l.color}}" 
        ng-class="{
            'metro-legend-fold': $parent.$parent.selected === $index,
            'metro-pie-unactive': $parent.$parent.visuallyActivePie !== undefined && $parent.$parent.visuallyActivePie !== $index}">
        <div class="p">
            <h4 class="serif metro-legend-title">{{l.percentage.toFixed(2)}} %</h4>
            <span class="uppercase">{{l.label}}</span>
        </div>
    </div>
</div>
</script>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.17/angular.min.js"></script>
<script src="../../bower_components/lodash/dist/lodash.min.js"></script>
<script src="main.js"></script>
<script src="../../services/utility.js"></script>
<script src="../../services/visualisation.js"></script>
<script src="../../directives/legend.js"></script>
<script src="../../directives/graph.js"></script>
<script src="../../directives/pie.js"></script>
<script src="../../directives/metro-pie.js"></script>
</body>
</html>
